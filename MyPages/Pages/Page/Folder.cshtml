@page "{id:int?}"
@model MyPages.Pages.Page.FolderModel
@{
    ViewData["Title"] = "Folder";
}

@section Styles {
    <link rel="stylesheet" href="~/css/folder.css" />
}

@if (Model.Folder == null)
{
    <h1>Unauthorized entry</h1>
    <hr />
}
else
{
    <ul class="nav path">

        @foreach (var folder in Model.FoldersPath)
        {
            <li class="nav-item">
                <a class="nav-link" asp-page="/Page/Folder" asp-route-id="@folder.Id">@folder.Name</a>
            </li>
        }
    </ul>
    <hr />
    @if (Model.Folder.Content != null)
    {
        <div id="content"></div>
        <hr />
    }
    <div class="row">
        @foreach (var item in Model.Items)
        {
            string style, href;
            if (item.ItemType == "Folder")
            {
                style = "btn-primary";
                href = "/Page/Folder";
            }
            else
            {
                style = "btn-secondary";
                href = "/Page/PageView";
            }
            <div class="col-lg-3 col-md-4 col-6 pl-md-2 pr-md-2 pl-1 pr-1 mt-2 mb-2 item">
                <button class="btn @style btn-delete text-white" data-toggle="modal" data-target="#deleteConfirm" data-item-type="@item.ItemType" data-item-name="@item.Name" data-item-id="@item.Id">&times;</button>
                <a class="btn btn-pages-list @style" asp-page="@href" asp-route-id="@item.Id">@item.Name</a>
            </div>
        }
        <div class="col-lg-3 col-md-4 col-6 pl-md-2 pr-md-2 pl-1 pr-1 mt-2 mb-2">
            <a class="btn btn-pages-list btn-outline-dark" asp-page="/Page/CreateItem" asp-route-id="@Model.Folder.Id">Create</a>
        </div>
    </div>
    <div id="deleteConfirm" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Are you sure?</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Do you really want to delete this element? This process cannot be undone.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-info" data-dismiss="modal">Cancel</button>
                    <button class="btn btn-danger" id="deleteConfirmButton">Delete</button>
                </div>
            </div>
        </div>
    </div>
    @section Scripts {
        <script type="text/javascript">
            $(() => {
                $('#content').append(mdToHtml('@Model.Folder.Content'));

                var itemType, itemId, itemName;
                $('#deleteConfirm').on('show.bs.modal', (e) => {
                    var button = $(e.relatedTarget);
                    itemType = button.data('item-type');
                    itemId = button.data('item-id');
                    itemName = button.data('item-name');
                });

                $('#deleteConfirmButton').on('click', () => {
                    var url = '/Delete/' + itemType + '/' + itemId;
                    $.ajax({
                        type: 'get',
                        url: url,
                        contentType: 'application/json'
                    }).done(function (e) {
                        window.location.reload();
                    });
                });

            })
        </script>
    }
}
